
==========================================================

CREATE SCHEMA
CREATE FUNCTION
CREATE FUNCTION
CREATE SCHEMA
CREATE FUNCTION
CREATE FUNCTION

# Compare the functions between two schemas in the same database
# Expect SQL (pseudocode):
#   Add function s2.increment
#   Replace function s2.add
#   Drop function s2.minus

-- schemaType: FUNCTION
-- db1: {db1 localhost 5432 u1 asdf s1 sslmode=disable}
-- db2: {db1 localhost 5432 u1 asdf s2 sslmode=disable}
-- Run the following SQL against db2:
-- This function is different so we'll recreate it:
-- STATEMENT-BEGIN
CREATE OR REPLACE FUNCTION s2.add(integer, integer)
 RETURNS integer
 LANGUAGE sql
 IMMUTABLE STRICT
AS $function$select $1 + $2;$function$
;
-- STATEMENT-END
-- STATEMENT-BEGIN
CREATE OR REPLACE FUNCTION s2.increment(i integer)
 RETURNS integer
 LANGUAGE plpgsql
AS $function$
    BEGIN
            RETURN i + 1;
    END;
$function$
 ;
-- STATEMENT-END
-- Note that CASCADE in the statement below will also drop any triggers depending on this function.
-- Also, if there are two functions with this name, you will want to add arguments to identify the correct one to drop.
-- (See http://www.postgresql.org/docs/9.4/interactive/sql-dropfunction.html) 
DROP FUNCTION s2.minus CASCADE;

==========================================================

CREATE SCHEMA
CREATE FUNCTION
CREATE FUNCTION
CREATE SCHEMA
CREATE FUNCTION
CREATE FUNCTION

# Compare the functions in all schemas between two databases
# Expect SQL (pseudocode):
#   Add function s1.add
#   Change/Replace function s2.add
#   Drop function s1.addition

-- schemaType: FUNCTION
-- db1: {db1 localhost 5432 u1 asdf * sslmode=disable}
-- db2: {db2 localhost 5432 u1 asdf * sslmode=disable}
-- Run the following SQL against db2:
-- STATEMENT-BEGIN
CREATE OR REPLACE FUNCTION s1.add(integer, integer)
 RETURNS integer
 LANGUAGE sql
 IMMUTABLE STRICT
AS $function$select $1 + $2;$function$
 ;
-- STATEMENT-END
-- Note that CASCADE in the statement below will also drop any triggers depending on this function.
-- Also, if there are two functions with this name, you will want to add arguments to identify the correct one to drop.
-- (See http://www.postgresql.org/docs/9.4/interactive/sql-dropfunction.html) 
DROP FUNCTION s1.addition CASCADE;
-- This function is different so we'll recreate it:
-- STATEMENT-BEGIN
CREATE OR REPLACE FUNCTION s2.add(bigint, bigint)
 RETURNS bigint
 LANGUAGE sql
 IMMUTABLE STRICT
AS $function$select $1 + $2;$function$
;
-- STATEMENT-END


